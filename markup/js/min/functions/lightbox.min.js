var lightbox=function(){return{updateList:function(a){$("#lightboxList");if(a){var b=$("tr[data-lightbox="+a+"]"),c=$("td:nth-child(2)",b),d=parseInt(c.text(),10);b.addClass("highlight"),c.text(d+1),setTimeout(function(){b.removeClass("highlight")},1e3)}else $.getJSON("/dan/lightboxe/",function(a){var b=$("#lightboxList");$("tbody > tr",b).remove(),$.each(a,function(a,c){var d;d='<tr data-data-lightbox="'+c.id+'">',d+="<td>"+c.name+"</td>",d+="<td>"+c.num_images+"</td>",d+='<td><a href="lightbox.htm" class="show icon">g</a></td>',d+="</tr>",$("tbody",b).append(d)})})},changeName:function(a,b){var c=this;$.ajax({url:"/dan/lightboxe/"+b+"/?name="+a,type:"POST"}).done(function(){var a=$('<div class="msg">Lightboxens navn er nu gemt</div>');$("#lightboxName").after(a),setTimeout(function(){a.fadeOut(500,function(){$(this).remove()})},2e3),c.updateList()})},getList:function(a,b){var c=this;$.getJSON("/dan/lightboxe/",function(d){var e=$("<div class='lightboxSelector' />");$.each(d,function(a,b){var c;c='<a href="#" data-lightboxid="'+b.id+'">',c+=b.name,c+="</a>",e.append(c)}),a.append(e),$("a",e).click(function(){var d=$(this).data("lightboxid");return e.remove(),"x"==$("a[data-action=lightbox]",a).text()&&$("a[data-action=lightbox]",a).text("b"),c.addImage(d,b),!1})})},deleteImage:function(a,b){var c=this;$.ajax({url:"/dan/lightboxe/"+a+"/"+b+"/",type:"DELETE"}).done(function(){c.updateList()})},addImage:function(a,b){var c=this;return $.ajax({url:"/dan/lightboxe/"+a+"/"+b+"/",type:"POST"}).done(function(){c.updateList(a)}),!1},init:function(){var a=this;$(".imgBox a[data-action='lightbox']").click(function(){var b=$(this),c=b.parent().parent(),d=$("img",c).data("id");return"b"==b.text()?(b.text("x"),a.getList(c,d)):(b.text("b"),$(".lightboxSelector",c).remove()),!1}),$("#lightboxName").blur(function(){var b=$(this),c=b.val(),d=b.data("lightboxid");a.changeName(c,d)}),$("#lightboxName").keypress(function(a){return 13==a.which&&$(this).blur(),!1}),$(".buttons a[data-action='lightbox']").click(function(){var b=$(this),c=b.parent(),d=b.data("billedid");return a.getList(c,d),!1}),$("a[data-action=delete]").click(function(){var b=$(this).parent().parent(),c=b.parent().data("lightboxid"),d=b.data("billedid");return b.css("background-color","#ED9DA7").fadeOut(1e3,function(){b.remove()}),a.deleteImage(c,d),!1})}}}();